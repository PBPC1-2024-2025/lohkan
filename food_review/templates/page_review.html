{% extends 'base.html' %}
{% load static %}

{% block content %}
{% include 'navbar.html' %}

<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Food</title>
</head>
<body>
    <div class="container" style="padding-top: 100px;">
        <h1 style=" font-size: 4rem; color: #900000; font-family: 'Helvetica', sans-serif; font-weight: bold; text-align: center; margin-bottom: 10px; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);">
        See How Others Rate the Food üòç
        </h1>
        <div class="search-bar" style="display: flex; justify-content: center; align-items: center; margin-bottom: 15px; width: 100%;">
            <form id="searchForm" method="GET" action="{% url 'food_review:page_review' %}" style="display: flex; justify-content: center; align-items: center; width: 90%;">
                <input type="text" name="search" placeholder="Find reviews by food name..." style="width: 75%; padding: 10px 20px; font-size: 1.0rem; font-family: 'Arial', sans-serif; border: 2px solid #900000; border-radius: 30px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); outline: none; transition: box-shadow 0.3s ease-in-out;">
                <button type="submit" id="searchButton" class="search-button" style="padding: 12px 20px; background-color: #900000; color: #ffffff; border: none; border-radius: 30px; font-size: 1.0rem; font-family: 'Arial', sans-serif; cursor: pointer; box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: background-color 0.3s ease-in-out, transform 0.2s; margin-left: 10px;">
                    Search
                </button>
                <button type="button" id="resetButton" class="reset-button" onclick="resetFilter()" style="padding: 12px 20px; background-color: #CCC; color: #000; border: none; border-radius: 30px; font-size: 1.0rem; font-family: 'Arial', sans-serif; cursor: pointer; box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); transition: background-color 0.3s ease-in-out, transform 0.2s; margin-left: 5px;">
                    Reset
                </button>
            </form>
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <button id="reviewButton" class="review-button" style="padding: 15px 30px; background-color: #900000; color: #ffffff; border: none; border-radius: 30px; font-size: 1.2rem; font-family: 'Arial', sans-serif; cursor: pointer; box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2); 
                transition: background-color 0.3s ease-in-out, transform 0.2s;">
                Review Your Food
            </button>
        </div>
        <div class="categories" style="text-align: center; margin: 20px 0;">
            <a href="{% url 'food_review:page_review' %}?type=All" 
                style="padding: 10px 20px; margin: 5px; background-color: #900000; color: white; font-weight: normal; text-decoration: none; border-radius: 8px; transition: background-color 0.3s ease-in-out; display: inline-block; font-family: 'Arial', sans-serif; border: 1px solid #ccc;"
                onmouseover="this.style.backgroundColor='#600000';" 
                onmouseout="this.style.backgroundColor='#900000';">
            All
            </a>
            <a href="{% url 'food_review:page_review' %}?type=Main Course" 
                style="padding: 10px 20px; margin: 5px; background-color: #900000; color: white; font-weight: normal; text-decoration: none; border-radius: 8px; transition: background-color 0.3s ease-in-out; display: inline-block; font-family: 'Arial', sans-serif; border: 1px solid #ccc;"
                onmouseover="this.style.backgroundColor='#600000';" 
                onmouseout="this.style.backgroundColor='#900000';">
               Main Course
            </a>
            <a href="{% url 'food_review:page_review' %}?type=Dessert" 
               style="padding: 10px 20px; margin: 5px; background-color: #900000; color: white; font-weight: normal; text-decoration: none; border-radius: 8px; transition: background-color 0.3s ease-in-out; display: inline-block; font-family: 'Arial', sans-serif; border: 1px solid #ccc;"
               onmouseover="this.style.backgroundColor='#600000';" 
               onmouseout="this.style.backgroundColor='#900000';">
               Dessert
            </a>
            <a href="{% url 'food_review:page_review' %}?type=Drinks" 
                style="padding: 10px 20px; margin: 5px; background-color: #900000; color: white; font-weight: normal; text-decoration: none; border-radius: 8px; transition: background-color 0.3s ease-in-out; display: inline-block; font-family: 'Arial', sans-serif; border: 1px solid #ccc;"
                onmouseover="this.style.backgroundColor='#600000';" 
                onmouseout="this.style.backgroundColor='#900000';">
               Drinks
            </a>
            <a href="{% url 'food_review:page_review' %}?type=Snacks" 
                style="padding: 10px 20px; margin: 5px; background-color: #900000; color: white; font-weight: normal; text-decoration: none; border-radius: 8px; transition: background-color 0.3s ease-in-out; display: inline-block; font-family: 'Arial', sans-serif; border: 1px solid #ccc;"
                onmouseover="this.style.backgroundColor='#600000';" 
                onmouseout="this.style.backgroundColor='#900000';">
               Snacks
            </a>
        </div>
        
        <div class="food-item" style="display: flex; flex-wrap: wrap; justify-content: center;">
            {% for review in reviews %}
            <div class="review-card" style="
                border: 1px solid #B3AE94; 
                padding: 15px; 
                margin: 10px; 
                background: linear-gradient(145deg, #FFF9E9, #F2E3D5); 
                border-radius: 30px; 
                box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.1), 
                            -5px -5px 15px rgba(255, 255, 255, 0.7); 
                width: 250px; /* Adjust width as necessary */ 
                transition: transform 0.3s, box-shadow 0.3s;">
        
                <div class="food-type" style="
                    background-color: #550000; 
                    color: #FFFFFF; 
                    padding: 5px 15px; 
                    border-radius: 20px; 
                    text-transform: capitalize; 
                    display: inline-block; 
                    font-weight: bold; 
                    position: absolute; 
                    top: 15px; 
                    left: 15px;">
                    {{ review.food_type }}
                </div>
                
                <h2 class="food-name" style="
                    margin-top: 50px; /* Adjust margin for food name placement */
                    font-size: 1.5rem; 
                    font-weight: bold; 
                    color: #550000; 
                    text-align: center;">
                    {{ review.name }}
                </h2>
                
                <button onclick="window.location.href='{% url 'food_review:see_reviews' review.name review.food_type %}'" 
                    style="
                    padding: 10px 20px; 
                    background-color: #550000; 
                    color: #FFFFFF; 
                    border: none; 
                    border-radius: 25px; 
                    cursor: pointer; 
                    transition: background-color 0.3s, transform 0.3s; 
                    width: 100%; 
                    margin-top: 20px;">
                    See Reviews ({{ review.review_count }})
                </button>
            </div>
            {% empty %}
            <p>Data makanannya belum ada nih üòî</p>
            {% endfor %}
        </div>
        
        <style>
        .review-card {
            position: relative; /* Ensure food type tag is positioned correctly */
        }
        
        .review-card:hover {
            transform: translateY(-5px); /* Lift the card slightly on hover */
            box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.2), 
                        -5px -5px 20px rgba(255, 255, 255, 0.8); /* Enhance shadow on hover */
        }
        </style>
        
        
    </div>

    <!-- Modal for Submitting New Review -->
    <div id="reviewModal" class="modal" style="display:none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.6);">
        <div class="modal-content" style="background-color: #e7e2d8; margin: 10% auto; padding: 30px; border: none; border-radius: 15px; width: 40%; box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2); font-family: 'Arial', sans-serif;">
            <span class="close" style="color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
            <form id="reviewForm">
                <h2 style="font-size: 2rem; color: #333; margin-bottom: 20px; text-align: center; font-weight: bold;">üìù Write a Review</h2>
                {% csrf_token %}
                <input type="text" name="name" placeholder="Food Name" required style="width: 100%; padding: 12px 15px; margin-bottom: 15px; font-size: 1rem; border: 1px solid #ccc; border-radius: 10px; box-shadow: inset 0px 2px 5px rgba(0, 0, 0, 0.1); outline: none;">
                <select name="food_type" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; font-size: 1rem; border: 1px solid #ccc; border-radius: 10px; box-shadow: inset 0px 2px 5px rgba(0, 0, 0, 0.1); outline: none;">
                    <option value="" disabled selected>Select food type</option>
                    <option value="Main Course">Main Course</option>
                    <option value="Dessert">Dessert</option>
                    <option value="Drinks">Drinks</option>
                    <option value="Snacks">Snacks</option>
                </select>
                <input type="number" name="rating" placeholder="Rating (1-5)" required min="1" max="5" style="width: 100%; padding: 12px 15px; margin-bottom: 15px; font-size: 1rem; border: 1px solid #ccc; border-radius: 10px; box-shadow: inset 0px 2px 5px rgba(0, 0, 0, 0.1); outline: none;">
                <textarea name="comments" placeholder="Comments" style="width: 100%; padding: 15px; margin-bottom: 20px; font-size: 1rem; border: 1px solid #ccc; border-radius: 10px; box-shadow: inset 0px 2px 5px rgba(0, 0, 0, 0.1); resize: vertical; outline: none;"></textarea>
                <button type="submit" style="width: 100%; padding: 15px; background-color: #812828; color: #ffffff; font-size: 1.2rem; font-family: 'Arial', sans-serif; border: none; border-radius: 25px; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);">üöÄ Publish!</button>
            </form>
        </div>
    </div>
    
</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Handle the reset functionality
function resetFilter() {
    // Redirect to the page_review URL without any filters or reset the filter state as needed
    window.location.href = '{% url "food_review:page_review" %}?type=All';
}
$(document).ready(function(){
    var modal = $('#reviewModal'); // Ensure this is the correct ID
    var btn = $('#reviewButton'); // Button that triggers the modal
    var span = $('.close'); // Close button in the modal

    // Show the modal when the "Review Your Food" button is clicked
    btn.click(function() {
        modal.show();
    });

    // Hide the modal when the "close" span is clicked
    span.click(function() {
        modal.hide();
    });

    // Also hide the modal when clicking outside of it
    $(window).click(function(event) {
        if (event.target == modal[0]) {
            modal.hide();
        }
    });

    // Handle the form submission with AJAX
    $('#reviewForm').submit(function(event){
        event.preventDefault();
        $.ajax({
            url: '{% url "food_review:add_review_ajax" %}',
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
                'name': $('input[name="name"]').val(),
                'food_type': $('select[name="food_type"]').val(),
                'rating': $('input[name="rating"]').val(),
                'comments': $('textarea[name="comments"]').val()
            },
            success: function(response) {
                modal.hide();
                location.reload(); // Optionally reload the page to update the list of reviews
            },
            error: function() {
                alert('Error adding review.');
            }
        });
    });
    
});
</script>


</html>
{% endblock content %}
