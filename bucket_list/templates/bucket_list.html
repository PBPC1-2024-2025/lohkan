{% extends 'base.html' %}
{% load static %}

{% block meta %}
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
<title>Bucket list</title>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<div id="bucket_list_entry"></div>
{% comment %} add bucket list {% endcomment %}
<div id="addBucketListModal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50 overflow-x-hidden overflow-y-auto">
    <div id="addBucketListModalContent" class="relative bg-white p-6 rounded-2xl shadow-lg w-5/6 sm:w-3/4 md:w-1/2 lg:w-1/4 mx-4 sm:mx-0 transform">

        <div id="closeModal" class="absolute right-4 top-4 cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" height="28px" viewBox="0 -960 960 960" width="28px" fill="#000000"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
        </div>

        <div>
            <h2 class="text-xl font-bold mt-2">Add new bucket list</h2>
        </div>

        <form id="bucketListForm">
            <div>
                <input type="text" class="border-2 border-[#CCC7BA] px-2 py-1 mt-4 w-full rounded-lg font-bold placeholder-[#CCC7BA]" placeholder="List name" required>
            </div>
        </form>

        <div class="flex justify-end mt-0.5">
            <p class="text-[#CCC7BA] font-bold text-sm">0/20</p>
        </div>

        <button type="submit" form="bucketListForm" class="px-2 py-1 mt-2 w-full rounded-lg bg-black text-white font-bold">
            Add new collection
        </button>
    </div>
</div>

<script>


    async function getBucketListEntries() {
        return fetch("{% url 'bucket_list:show_json' %}").then((res) => res.json())
    }

    async function refreshBucketListEntries() {
        document.getElementById("bucket_list_entry").innerHTML = "";
        document.getElementById("bucket_list_entry").className = "";
        const bucketListEntries = await getBucketListEntries();
        let htmlString = "";
        let classNameString = "";

        console.log(bucketListEntries.length)
        if (bucketListEntries.length === 0) {
            classNameString = "flex flex-col gap-2 w-full h-[90vh] border-2 justify-center items-center";
            htmlString = `
                <h2 class="text-lg font-bold">Yuk, mulai isi bucket list kamu!</h2>
                <button data-model-target="addBucketListModal" data-modal-toggle="addBucketListModal" class="flex items-center btn bg-black cursor-pointer rounded-2xl px-6 py-2 transform" onclick="showModal();">
                    <p class="text-white font-bold">Add new list</p>
                </button>
            `;
        }
        document.getElementById("bucket_list_entry").className = classNameString;
        document.getElementById("bucket_list_entry").innerHTML = htmlString;
    }
    refreshBucketListEntries()

    const modal = document.getElementById('addBucketListModal');
    const modalContent = document.getElementById('addBucketListModalContent');

    function showModal() {
        modal.classList.remove('hidden'); 
        setTimeout(() => {}, 50); 
    }

    function hideModal() {
        modal.classList.add('hidden');
        setTimeout(() => {}, 50); 
    }

    document.getElementById("closeModal").addEventListener("click", () => {
        hideModal();
    });

    modal.addEventListener('click', function (event) {
        if (event.target === modal) {
            hideModal();
        }
    });

    function addBucketListEntry() {
        fetch("{% url 'bucket_list:add_bucket_list' %}", {
            method: "POST",
            body: new FormData(document.querySelector('#bucketListForm')),
        })
        .then(response => refreshBucketListEntries());
    
        document.getElementById("bucketListForm").reset(); 
        document.querySelector("[data-modal-toggle='addBucketListModal']").click();
    
        return false;
    }
    
    
        document.getElementById("bucketListForm").addEventListener("submit", (e) => {
            e.preventDefault();
            addBucketListEntry();
            hideModal();
        })

    {% comment %} async function getFoodEntries() {
        return fetch("{% url 'main:show_json' %}").then((res) => res.json())
    } {% endcomment %}

</script>

{% endblock content %}