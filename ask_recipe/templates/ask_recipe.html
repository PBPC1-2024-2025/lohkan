{% extends 'base.html' %}

{% block content %}
    <!-- Navbar -->
    {% include 'navbar.html' %}
    
    <!-- Main Content -->
    <div class="flex flex-row pt-20">
        <!-- Left Side: Chat Group List -->
        <div class="w-1/3 bg-[#550000] text-white p-4 h-screen overflow-y-auto shadow-lg relative scrollbar-thin scrollbar-thumb-[#00cc99] scrollbar-track-[#2b2b2e]">
            <!-- Header with Plus Button -->
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-extrabold">Ask Recipe</h2>
                <button id="add-group-btn" class="text-[#00cc99] hover:text-[#00ffbb] transition duration-300">
                    <i class="fas fa-plus-circle text-2xl"></i>
                </button>
            </div>
            
            <!-- Search Bar -->
            <div class="mb-4">
                <input type="text" placeholder="Search" class="w-full p-2 rounded-lg bg-[#440000] text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00cc99]">
            </div>

            <!-- Chat List -->
            <ul class="space-y-2">
                {% for chat in chats %}
                <li class="flex justify-between items-center px-3 py-2 bg-[#2b2b2e] rounded-lg hover:bg-[#3c3c3e] transition cursor-pointer">
                    <div class="flex items-center">
                        <img src="{{ chat.image_url }}" alt="Avatar" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <p class="font-semibold">{{ chat.name }}</p>
                            <p class="text-sm text-gray-400">{{ chat.last_message|truncatewords:5 }}</p>
                        </div>
                    </div>
                    <span class="text-sm text-gray-500">{{ chat.time }}</span>
                </li>
                {% empty %}
                <p class="text-center text-gray-400">No chats available. Start a conversation!</p>
                {% endfor %}
            </ul>

            <!-- Hidden Form for Ajax (Initially Hidden) -->
            <div id="add-group-form" class="absolute top-0 left-0 w-full h-full bg-[#202125] bg-opacity-90 flex items-center justify-center hidden">
                <div class="bg-white p-6 rounded-lg w-3/4 max-w-md">
                    <h2 class="text-xl font-bold mb-4 text-[#202125]">Create New Group</h2>
                    <form id="ajax-group-form">
                        <input type="text" name="group_name" placeholder="Group Name" class="w-full mb-3 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00cc99]">
                        <button type="submit" class="w-full py-2 bg-[#00cc99] text-white rounded-lg hover:bg-[#00ffbb] transition duration-300">Create Group</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Side: Chat Area -->
        <div class="w-2/3 p-6 bg-white flex flex-col">
            <!-- Chat Header -->
            <div class="mb-4 border-b pb-2 flex justify-between items-center">
                <h2 class="text-3xl font-bold text-[#550000]">Chat</h2>
                <a href="{% url 'ask_recipe:create_recipe_group' %}" class="text-sm bg-[#550000] text-white py-1 px-3 rounded hover:bg-[#770000] transition duration-300">
                    + Create New Group
                </a>
            </div>
            
            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto mb-4 p-4 bg-gray-100 rounded-lg">
                <div class="space-y-4">
                    {% for message in messages %}
                        <div class="p-4 bg-white rounded-lg shadow-md">
                            <div class="flex justify-between items-center">
                                <p class="text-[#550000] font-semibold">{{ message.user.username }}</p>
                                <span class="text-gray-500 text-sm">{{ message.timestamp|date:"M d, Y - H:i" }}</span>
                            </div>
                            <p class="mt-2 text-gray-800">{{ message.message }}</p>
                        </div>
                    {% empty %}
                        <p class="text-center text-gray-500">No messages yet. Start the conversation!</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Message Input -->
            <form action="{% url 'ask_recipe:add_chat_message' %}" method="POST" class="flex items-center space-x-3">
                {% csrf_token %}
                <input type="hidden" name="id" value="{{ group.id }}">
                <textarea name="content" rows="2" class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#550000]" placeholder="Type your message..."></textarea>
                <button type="submit" class="bg-gradient-to-r from-[#550000] to-[#770000] text-white py-2 px-5 rounded-full hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                    Send
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock content %}